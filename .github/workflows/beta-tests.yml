name: beta-tests
on: 
  workflow_dispatch:
    inputs:
      xcode-version:
        required: true

jobs:
  testIOSBeta:
    name : TestIOSBeta
    # runs-on: will be set to macos-latest when running on actual GHA. 
    # *** runs-on: ubuntu-latest is used when running via act on mac os. ***
    runs-on: macos-13 
    steps:
    - uses: actions/checkout@master
      with: 
        submodules: true
    
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: ${{ env.xcode-version }}

    - name: Install lcov
      run: brew install lcov

    - name: Update gem
      run: bundle update

    - name: Install gems
      run: bundle install

    - name: Run tests on iOS (using fastlane)
      run: bundle exec fastlane runIOSBetaTests

    - name: Run example app tests on iOS (using fastlane)
      run: bundle exec fastlane runIOSBetaAppTests

  testTVOSBeta:
    name : TestTVOSBeta
    # runs-on: will be set to macos-latest when running on actual GHA. 
    # *** runs-on: ubuntu-latest is used when running via act on mac os. ***
    runs-on: macos-latest 
    steps:
    - uses: actions/checkout@v3
      with: 
        submodules: true
    
    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: ${{ env.xcode-version }}

    - name: Install lcov
      run: brew install lcov

    - name: Update gem
      run: bundle update

    - name: Install gems
      run: bundle install

    - name: Run tests on tvOS (using fastlane)
      run: bundle exec fastlane runTVOSBetaTests
name: beta-test
on: 
  workflow_dispatch:
    inputs:
      version:
        required: true

jobs:
    testIOS:
        name : TestIOS 
        # runs-on: will be set to macos-latest when running on actual GHA. 
        # *** runs-on: ubuntu-latest is used when running via act on mac os. ***
        runs-on: macos-13 
        steps:
        - uses: actions/checkout@master
        with: 
            submodules: true
        
        - uses: maxim-lobanov/setup-xcode@v1
        with:
            xcode-version: '14.3'
    
        - name: Install lcov
        run: brew install lcov
    
        - name: Update gem
        run: bundle update
    
        - name: Install gems
        run: bundle install
    
        - name: Run tests on iOS (using fastlane)
        run: bundle exec fastlane runIOSTests
    
        - uses: codecov/codecov-action@v3
        with:
            token: ${{ secrets.CODECOV_TOKEN }}
            files: coverage.xml
    
    testTVOS:
        name : TestTVOS
        # runs-on: will be set to macos-latest when running on actual GHA. 
        # *** runs-on: ubuntu-latest is used when running via act on mac os. ***
        runs-on: macos-latest 
        steps:
        - uses: actions/checkout@v3
        with: 
            submodules: true
        
        - uses: maxim-lobanov/setup-xcode@v1
        with:
            xcode-version: '14.2'
    
        - name: Install lcov
        run: brew install lcov
    
        - name: Update gem
        run: bundle update
    
        - name: Install gems
        run: bundle install
    
        - name: Run tests on tvOS (using fastlane)
        run: bundle exec fastlane runTVOSTests
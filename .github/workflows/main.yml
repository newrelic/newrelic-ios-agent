name: CI
on: push

jobs:
  test:
    # runs-on: will be set to macos-latest when running on actual GHA. 
    # *** runs-on: ubuntu-latest is used when running via act on mac os. ***
    runs-on: macos-latest 
    steps:
    - uses: actions/checkout@v3
      with: 
        submodules: true

    - uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '14.1'

    - name: Install gems
      run: bundle install

    # - name: Run iOS tests using only Xcode build.
    #   run: xcodebuild -workspace Agent.xcworkspace -scheme "Agent-iOS" -destination name="iPhone 14" -derivedDataPath="dd" clean test

    # - name: Run tvOS tests using only Xcode build.
    #   run: xcodebuild -workspace Agent.xcworkspace -scheme "Agent-tvOS" -destination name="Apple TV" -derivedDataPath="dd" clean test
    
    # - name: Run tests on iOS. (Using fastlane)
    #   run: bundle exec fastlane runIOSTests

    # - name: Archive iOS. (Using xcodebuild)
    #   run: xcodebuild clean archive -archivePath "archives/iOS.xcarchive" -configuration "Release" -workspace "Agent.xcworkspace" -scheme "Agent-iOS" -sdk "iphoneos" SKIP_INSTALL=NO BUILD_LIBRARIES_FOR_DISTRIBUTION=YES 

    - name: Run tests and build NewRelic.xcframework (using fastlane)
      run: bundle exec fastlane testAndBuild

    # - name: run the Agent iOS Tests and tvOS Tests (using fastlane)
    #   run: bundle exec fastlane runTests